{"remainingRequest":"/Users/chenxing/WebProjects/lib_web/frontend/vue-web-frontiers/node_modules/babel-loader/lib/index.js!/Users/chenxing/WebProjects/lib_web/frontend/vue-web-frontiers/node_modules/eslint-loader/index.js??ref--13-0!/Users/chenxing/WebProjects/lib_web/frontend/vue-web-frontiers/src/permission.js","dependencies":[{"path":"/Users/chenxing/WebProjects/lib_web/frontend/vue-web-frontiers/src/permission.js","mtime":1719405576511},{"path":"/Users/chenxing/WebProjects/lib_web/frontend/vue-web-frontiers/babel.config.js","mtime":1717069957203},{"path":"/Users/chenxing/WebProjects/lib_web/frontend/vue-web-frontiers/node_modules/cache-loader/dist/cjs.js","mtime":1717069957692},{"path":"/Users/chenxing/WebProjects/lib_web/frontend/vue-web-frontiers/node_modules/babel-loader/lib/index.js","mtime":1717069957536},{"path":"/Users/chenxing/WebProjects/lib_web/frontend/vue-web-frontiers/node_modules/eslint-loader/index.js","mtime":1717069958256}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9yZWdlbmVyYXRvclJ1bnRpbWUgZnJvbSAiL1VzZXJzL2NoZW54aW5nL1dlYlByb2plY3RzL2xpYl93ZWIvZnJvbnRlbmQvdnVlLXdlYi1mcm9udGllcnMvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3JlZ2VuZXJhdG9yUnVudGltZS5qcyI7CmltcG9ydCBfb2JqZWN0U3ByZWFkIGZyb20gIi9Vc2Vycy9jaGVueGluZy9XZWJQcm9qZWN0cy9saWJfd2ViL2Zyb250ZW5kL3Z1ZS13ZWItZnJvbnRpZXJzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyLmpzIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9jaGVueGluZy9XZWJQcm9qZWN0cy9saWJfd2ViL2Zyb250ZW5kL3Z1ZS13ZWItZnJvbnRpZXJzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yLmpzIjsKaW1wb3J0IHJvdXRlciBmcm9tICIuL3JvdXRlciI7CmltcG9ydCBzdG9yZSBmcm9tICIuL3N0b3JlIjsKaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gImVsZW1lbnQtdWkiOwppbXBvcnQgTlByb2dyZXNzIGZyb20gIm5wcm9ncmVzcyI7IC8vIHByb2dyZXNzIGJhcgppbXBvcnQgIm5wcm9ncmVzcy9ucHJvZ3Jlc3MuY3NzIjsgLy8gcHJvZ3Jlc3MgYmFyIHN0eWxlCmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAiQC91dGlscy9hdXRoIjsgLy8gZ2V0IHRva2VuIGZyb20gY29va2llCmltcG9ydCBnZXRQYWdlVGl0bGUgZnJvbSAiQC91dGlscy9nZXQtcGFnZS10aXRsZSI7Ck5Qcm9ncmVzcy5jb25maWd1cmUoewogIHNob3dTcGlubmVyOiBmYWxzZQp9KTsgLy8gTlByb2dyZXNzIENvbmZpZ3VyYXRpb24KCnZhciB3aGl0ZUxpc3QgPSBbIi9sb2dpbiIsICIvc2lnbmluIiwgIi9kYXNoYm9hcmQiXTsgLy8gbm8gcmVkaXJlY3Qgd2hpdGVsaXN0Cgpyb3V0ZXIuYmVmb3JlRWFjaCggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSh0bywgZnJvbSwgbmV4dCkgewogICAgdmFyIGhhc1Rva2VuLCBoYXNSb2xlczsKICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIC8vIHN0YXJ0IHByb2dyZXNzIGJhcgogICAgICAgICAgTlByb2dyZXNzLnN0YXJ0KCk7CgogICAgICAgICAgLy8gc2V0IHBhZ2UgdGl0bGUKICAgICAgICAgIGRvY3VtZW50LnRpdGxlID0gZ2V0UGFnZVRpdGxlKHRvLm1ldGEudGl0bGUpOwoKICAgICAgICAgIC8vIGRldGVybWluZSB3aGV0aGVyIHRoZSB1c2VyIGhhcyBsb2dnZWQgaW4KICAgICAgICAgIGhhc1Rva2VuID0gZ2V0VG9rZW4oKTsKICAgICAgICAgIGlmICghaGFzVG9rZW4pIHsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI2OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghKHRvLnBhdGggPT09ICIvbG9naW4iKSkgewogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBpZiBpcyBsb2dnZWQgaW4sIHJlZGlyZWN0IHRvIHRoZSBob21lIHBhZ2UKICAgICAgICAgIG5leHQoewogICAgICAgICAgICBwYXRoOiAiLyIKICAgICAgICAgIH0pOwogICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAyNDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgOToKICAgICAgICAgIC8vIGRldGVybWluZSB3aGV0aGVyIHRoZSB1c2VyIGhhcyBvYnRhaW5lZCBoaXMgcGVybWlzc2lvbiByb2xlcyB0aHJvdWdoIGdldEluZm8KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHN0b3JlLmdldHRlcnMucm9sZXMsICJzdG9yZS5nZXR0ZXJzLnJvbGVzIik7CiAgICAgICAgICBoYXNSb2xlcyA9IHN0b3JlLmdldHRlcnMucm9sZXMgJiYgc3RvcmUuZ2V0dGVycy5yb2xlcy5sZW5ndGggPiAwOyAvLyBjb25zb2xlLmxvZyhoYXNSb2xlcywgImhhc1JvbGVzIik7CiAgICAgICAgICBpZiAoIWhhc1JvbGVzKSB7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxNDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjQ7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE0OgogICAgICAgICAgX2NvbnRleHQucHJldiA9IDE0OwogICAgICAgICAgLy8gZ2V0IHVzZXIgaW5mbwogICAgICAgICAgLy8gbm90ZTogcm9sZXMgbXVzdCBiZSBhIG9iamVjdCBhcnJheSEgc3VjaCBhczogWydhZG1pbiddIG9yICxbJ2RldmVsb3BlcicsJ2VkaXRvciddCiAgICAgICAgICAvLyBjb25zdCB7IHJvbGVzIH0gPSBhd2FpdCBzdG9yZS5kaXNwYXRjaCgidXNlci9nZXRJbmZvIik7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhyb2xlcywgInJvbGVzIik7CgogICAgICAgICAgLy8gZ2VuZXJhdGUgYWNjZXNzaWJsZSByb3V0ZXMgbWFwIGJhc2VkIG9uIHJvbGVzCiAgICAgICAgICAvLyBjb25zdCBhY2Nlc3NSb3V0ZXMgPSBhd2FpdCBzdG9yZS5kaXNwYXRjaCgKICAgICAgICAgIC8vICAgInBlcm1pc3Npb24vZ2VuZXJhdGVSb3V0ZXMiLAogICAgICAgICAgLy8gICByb2xlcwogICAgICAgICAgLy8gKTsKCiAgICAgICAgICAvLyBkeW5hbWljYWxseSBhZGQgYWNjZXNzaWJsZSByb3V0ZXMKICAgICAgICAgIC8vIHJvdXRlci5hZGRSb3V0ZXMoYWNjZXNzUm91dGVzKTsKCiAgICAgICAgICAvLyBoYWNrIG1ldGhvZCB0byBlbnN1cmUgdGhhdCBhZGRSb3V0ZXMgaXMgY29tcGxldGUKICAgICAgICAgIC8vIHNldCB0aGUgcmVwbGFjZTogdHJ1ZSwgc28gdGhlIG5hdmlnYXRpb24gd2lsbCBub3QgbGVhdmUgYSBoaXN0b3J5IHJlY29yZAogICAgICAgICAgbmV4dChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHRvKSwge30sIHsKICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZQogICAgICAgICAgfSkpOwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI0OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxODoKICAgICAgICAgIF9jb250ZXh0LnByZXYgPSAxODsKICAgICAgICAgIF9jb250ZXh0LnQwID0gX2NvbnRleHRbImNhdGNoIl0oMTQpOwogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDIyOwogICAgICAgICAgcmV0dXJuIHN0b3JlLmRpc3BhdGNoKCJ1c2VyL3Jlc2V0VG9rZW4iKTsKICAgICAgICBjYXNlIDIyOgogICAgICAgICAgLy8gTWVzc2FnZS5lcnJvcihlcnJvciB8fCAiSGFzIEVycm9yIik7CiAgICAgICAgICBuZXh0KCIvbG9naW4/cmVkaXJlY3Q9Ii5jb25jYXQodG8ucGF0aCkpOwogICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTsKICAgICAgICBjYXNlIDI0OgogICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI3OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNjoKICAgICAgICAgIC8qIGhhcyBubyB0b2tlbiovCgogICAgICAgICAgaWYgKHdoaXRlTGlzdC5pbmRleE9mKHRvLnBhdGgpICE9PSAtMSkgewogICAgICAgICAgICAvLyBpbiB0aGUgZnJlZSBsb2dpbiB3aGl0ZWxpc3QsIGdvIGRpcmVjdGx5CiAgICAgICAgICAgIG5leHQoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIG90aGVyIHBhZ2VzIHRoYXQgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBhY2Nlc3MgYXJlIHJlZGlyZWN0ZWQgdG8gdGhlIGxvZ2luIHBhZ2UuCiAgICAgICAgICAgIG5leHQoIi9sb2dpbj9yZWRpcmVjdD0iLmNvbmNhdCh0by5wYXRoKSk7CiAgICAgICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7CiAgICAgICAgICB9CiAgICAgICAgY2FzZSAyNzoKICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgfQogICAgfSwgX2NhbGxlZSwgbnVsbCwgW1sxNCwgMThdXSk7CiAgfSkpOwogIHJldHVybiBmdW5jdGlvbiAoX3gsIF94MiwgX3gzKSB7CiAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKSk7CnJvdXRlci5hZnRlckVhY2goZnVuY3Rpb24gKCkgewogIC8vIGZpbmlzaCBwcm9ncmVzcyBiYXIKICBOUHJvZ3Jlc3MuZG9uZSgpOwp9KTs="},{"version":3,"names":["router","store","Message","NProgress","getToken","getPageTitle","configure","showSpinner","whiteList","beforeEach","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","to","from","next","hasToken","hasRoles","wrap","_callee$","_context","prev","start","document","title","meta","path","done","getters","roles","length","_objectSpread","replace","t0","dispatch","concat","indexOf","stop","_x","_x2","_x3","apply","arguments","afterEach"],"sources":["/Users/chenxing/WebProjects/lib_web/frontend/vue-web-frontiers/src/permission.js"],"sourcesContent":["import router from \"./router\";\nimport store from \"./store\";\nimport { Message } from \"element-ui\";\nimport NProgress from \"nprogress\"; // progress bar\nimport \"nprogress/nprogress.css\"; // progress bar style\nimport { getToken } from \"@/utils/auth\"; // get token from cookie\nimport getPageTitle from \"@/utils/get-page-title\";\n\nNProgress.configure({ showSpinner: false }); // NProgress Configuration\n\nconst whiteList = [\"/login\", \"/signin\", \"/dashboard\"]; // no redirect whitelist\n\nrouter.beforeEach(async (to, from, next) => {\n  // start progress bar\n  NProgress.start();\n\n  // set page title\n  document.title = getPageTitle(to.meta.title);\n\n  // determine whether the user has logged in\n  const hasToken = getToken();\n\n  if (hasToken) {\n    if (to.path === \"/login\") {\n      // if is logged in, redirect to the home page\n      next({ path: \"/\" });\n      NProgress.done();\n    } else {\n      // determine whether the user has obtained his permission roles through getInfo\n      // console.log(store.getters.roles, \"store.getters.roles\");\n      const hasRoles = store.getters.roles && store.getters.roles.length > 0;\n      // console.log(hasRoles, \"hasRoles\");\n      if (hasRoles) {\n        next();\n      } else {\n        try {\n          // get user info\n          // note: roles must be a object array! such as: ['admin'] or ,['developer','editor']\n          // const { roles } = await store.dispatch(\"user/getInfo\");\n          // console.log(roles, \"roles\");\n\n          // generate accessible routes map based on roles\n          // const accessRoutes = await store.dispatch(\n          //   \"permission/generateRoutes\",\n          //   roles\n          // );\n\n          // dynamically add accessible routes\n          // router.addRoutes(accessRoutes);\n\n          // hack method to ensure that addRoutes is complete\n          // set the replace: true, so the navigation will not leave a history record\n          next({ ...to, replace: true });\n        } catch (error) {\n          // remove token and go to login page to re-login\n          await store.dispatch(\"user/resetToken\");\n          // Message.error(error || \"Has Error\");\n          next(`/login?redirect=${to.path}`);\n          NProgress.done();\n        }\n      }\n    }\n  } else {\n    /* has no token*/\n\n    if (whiteList.indexOf(to.path) !== -1) {\n      // in the free login whitelist, go directly\n      next();\n    } else {\n      // other pages that do not have permission to access are redirected to the login page.\n      next(`/login?redirect=${to.path}`);\n      NProgress.done();\n    }\n  }\n});\n\nrouter.afterEach(() => {\n  // finish progress bar\n  NProgress.done();\n});\n"],"mappings":"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","ignoreList":[]}]}